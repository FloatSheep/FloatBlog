var hs=Object.defineProperty;var Pt=v=>{throw TypeError(v)};var ls=(v,b,E)=>b in v?hs(v,b,{enumerable:!0,configurable:!0,writable:!0,value:E}):v[b]=E;var d=(v,b,E)=>ls(v,typeof b!="symbol"?b+"":b,E),Je=(v,b,E)=>b.has(v)||Pt("Cannot "+E);var a=(v,b,E)=>(Je(v,b,"read from private field"),E?E.call(v):b.get(v)),p=(v,b,E)=>b.has(v)?Pt("Cannot add the same private member more than once"):b instanceof WeakSet?b.add(v):b.set(v,E),f=(v,b,E,oe)=>(Je(v,b,"write to private field"),oe?oe.call(v,E):b.set(v,E),E),g=(v,b,E)=>(Je(v,b,"access private method"),E);var It=(v,b,E,oe)=>({set _(_e){f(v,b,_e,E)},get _(){return a(v,b,oe)}});(function(){"use strict";var ue,D,B,Ct,$t,Xe,G,wt,Re,xe,W,ee,z,m,R,k,q,je,fe,de,Oe,Pe,$,H,yt,L,O,Nt,M,ie,Fe,Te,vt,te,se,F,bt,Le,Ie,mt,J,X,pe,kt,St,Et,Q,U,Rt,Y,C,re,ge,I,K,ae,xt,ne,jt;var v=(e,t,s)=>(r,i)=>{let n=-1;return c(0);async function c(h){if(h<=n)throw new Error("next() called multiple times");n=h;let o,l=!1,u;if(e[h]?(u=e[h][0][0],r.req.routeIndex=h):u=h===e.length&&i||void 0,u)try{o=await u(r,()=>c(h+1))}catch(w){if(w instanceof Error&&t)r.error=w,o=await t(w,r),l=!0;else throw w}else r.finalized===!1&&s&&(o=await s(r));return o&&(r.finalized===!1||l)&&(r.res=o),r}},b=async(e,t=Object.create(null))=>{const{all:s=!1,dot:r=!1}=t,n=(e instanceof it?e.raw.headers:e.headers).get("Content-Type");return n!=null&&n.startsWith("multipart/form-data")||n!=null&&n.startsWith("application/x-www-form-urlencoded")?E(e,{all:s,dot:r}):{}};async function E(e,t){const s=await e.formData();return s?oe(s,t):{}}function oe(e,t){const s=Object.create(null);return e.forEach((r,i)=>{t.all||i.endsWith("[]")?_e(s,i,r):s[i]=r}),t.dot&&Object.entries(s).forEach(([r,i])=>{r.includes(".")&&(At(s,r,i),delete s[r])}),s}var _e=(e,t,s)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(s):e[t]=[e[t],s]:e[t]=s},At=(e,t,s)=>{let r=e;const i=t.split(".");i.forEach((n,c)=>{c===i.length-1?r[n]=s:((!r[n]||typeof r[n]!="object"||Array.isArray(r[n])||r[n]instanceof File)&&(r[n]=Object.create(null)),r=r[n])})},Qe=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},Ht=e=>{const{groups:t,path:s}=Dt(e),r=Qe(s);return Lt(r,t)},Dt=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(s,r)=>{const i=`@${r}`;return t.push([i,s]),i}),{groups:t,path:e}},Lt=(e,t)=>{for(let s=t.length-1;s>=0;s--){const[r]=t[s];for(let i=e.length-1;i>=0;i--)if(e[i].includes(r)){e[i]=e[i].replace(r,t[s][1]);break}}return e},$e={},Ye=(e,t)=>{if(e==="*")return"*";const s=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(s){const r=`${e}#${t}`;return $e[r]||(s[2]?$e[r]=t&&t[0]!==":"&&t[0]!=="*"?[r,s[1],new RegExp(`^${s[2]}(?=/${t})`)]:[e,s[1],new RegExp(`^${s[2]}$`)]:$e[r]=[e,s[1],!0]),$e[r]}return null},Ze=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,s=>{try{return t(s)}catch{return s}})}},Mt=e=>Ze(e,decodeURI),et=e=>{const t=e.url,s=t.indexOf("/",8);let r=s;for(;r<t.length;r++){const i=t.charCodeAt(r);if(i===37){const n=t.indexOf("?",r),c=t.slice(s,n===-1?void 0:n);return Mt(c.includes("%25")?c.replace(/%25/g,"%2525"):c)}else if(i===63)break}return t.slice(s,r)},Ft=e=>{const t=et(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},ce=(e,t,...s)=>(s.length&&(t=ce(t,...s)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),tt=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),s=[];let r="";return t.forEach(i=>{if(i!==""&&!/\:/.test(i))r+="/"+i;else if(/\:/.test(i))if(/\?/.test(i)){s.length===0&&r===""?s.push("/"):s.push(r);const n=i.replace("?","");r+="/"+n,s.push(r)}else r+="/"+i}),s.filter((i,n,c)=>c.indexOf(i)===n)},Be=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?rt(e):e):e,st=(e,t,s)=>{let r;if(!s&&t&&!/[%+]/.test(t)){let c=e.indexOf(`?${t}`,8);for(c===-1&&(c=e.indexOf(`&${t}`,8));c!==-1;){const h=e.charCodeAt(c+t.length+1);if(h===61){const o=c+t.length+2,l=e.indexOf("&",o);return Be(e.slice(o,l===-1?void 0:l))}else if(h==38||isNaN(h))return"";c=e.indexOf(`&${t}`,c+1)}if(r=/[%+]/.test(e),!r)return}const i={};r??(r=/[%+]/.test(e));let n=e.indexOf("?",8);for(;n!==-1;){const c=e.indexOf("&",n+1);let h=e.indexOf("=",n);h>c&&c!==-1&&(h=-1);let o=e.slice(n+1,h===-1?c===-1?void 0:c:h);if(r&&(o=Be(o)),n=c,o==="")continue;let l;h===-1?l="":(l=e.slice(h+1,c===-1?void 0:c),r&&(l=Be(l))),s?(i[o]&&Array.isArray(i[o])||(i[o]=[]),i[o].push(l)):i[o]??(i[o]=l)}return t?i[t]:i},Tt=st,_t=(e,t)=>st(e,t,!0),rt=decodeURIComponent,nt=e=>Ze(e,rt),it=(wt=class{constructor(e,t="/",s=[[]]){p(this,B);d(this,"raw");p(this,ue);p(this,D);d(this,"routeIndex",0);d(this,"path");d(this,"bodyCache",{});p(this,G,e=>{const{bodyCache:t,raw:s}=this,r=t[e];if(r)return r;const i=Object.keys(t)[0];return i?t[i].then(n=>(i==="json"&&(n=JSON.stringify(n)),new Response(n)[e]())):t[e]=s[e]()});this.raw=e,this.path=t,f(this,D,s),f(this,ue,{})}param(e){return e?g(this,B,Ct).call(this,e):g(this,B,$t).call(this)}query(e){return Tt(this.url,e)}queries(e){return _t(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((s,r)=>{t[r]=s}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await b(this,e))}json(){return a(this,G).call(this,"json")}text(){return a(this,G).call(this,"text")}arrayBuffer(){return a(this,G).call(this,"arrayBuffer")}blob(){return a(this,G).call(this,"blob")}formData(){return a(this,G).call(this,"formData")}addValidatedData(e,t){a(this,ue)[e]=t}valid(e){return a(this,ue)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return a(this,D)[0].map(([[,e]])=>e)}get routePath(){return a(this,D)[0].map(([[,e]])=>e)[this.routeIndex].path}},ue=new WeakMap,D=new WeakMap,B=new WeakSet,Ct=function(e){const t=a(this,D)[0][this.routeIndex][1][e],s=g(this,B,Xe).call(this,t);return s?/\%/.test(s)?nt(s):s:void 0},$t=function(){const e={},t=Object.keys(a(this,D)[0][this.routeIndex][1]);for(const s of t){const r=g(this,B,Xe).call(this,a(this,D)[0][this.routeIndex][1][s]);r&&typeof r=="string"&&(e[s]=/\%/.test(r)?nt(r):r)}return e},Xe=function(e){return a(this,D)[1]?a(this,D)[1][e]:e},G=new WeakMap,wt),Bt={Stringify:1},at=async(e,t,s,r,i)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const n=e.callbacks;return n!=null&&n.length?(i?i[0]+=e:i=[e],Promise.all(n.map(h=>h({phase:t,buffer:i,context:r}))).then(h=>Promise.all(h.filter(Boolean).map(o=>at(o,t,!1,r,i))).then(()=>i[0]))):Promise.resolve(e)},Wt="text/plain; charset=UTF-8",We=(e,t={})=>{for(const s of Object.keys(t))e.set(s,t[s]);return e},zt=(yt=class{constructor(e,t){p(this,$);p(this,Re);p(this,xe);d(this,"env",{});p(this,W);d(this,"finalized",!1);d(this,"error");p(this,ee,200);p(this,z);p(this,m);p(this,R);p(this,k);p(this,q,!0);p(this,je);p(this,fe);p(this,de);p(this,Oe);p(this,Pe);d(this,"render",(...e)=>(a(this,fe)??f(this,fe,t=>this.html(t)),a(this,fe).call(this,...e)));d(this,"setLayout",e=>f(this,je,e));d(this,"getLayout",()=>a(this,je));d(this,"setRenderer",e=>{f(this,fe,e)});d(this,"header",(e,t,s)=>{if(this.finalized&&f(this,k,new Response(a(this,k).body,a(this,k))),t===void 0){a(this,m)?a(this,m).delete(e):a(this,R)&&delete a(this,R)[e.toLocaleLowerCase()],this.finalized&&this.res.headers.delete(e);return}s!=null&&s.append?(a(this,m)||(f(this,q,!1),f(this,m,new Headers(a(this,R))),f(this,R,{})),a(this,m).append(e,t)):a(this,m)?a(this,m).set(e,t):(a(this,R)??f(this,R,{}),a(this,R)[e.toLowerCase()]=t),this.finalized&&(s!=null&&s.append?this.res.headers.append(e,t):this.res.headers.set(e,t))});d(this,"status",e=>{f(this,q,!1),f(this,ee,e)});d(this,"set",(e,t)=>{a(this,W)??f(this,W,new Map),a(this,W).set(e,t)});d(this,"get",e=>a(this,W)?a(this,W).get(e):void 0);d(this,"newResponse",(...e)=>g(this,$,H).call(this,...e));d(this,"body",(e,t,s)=>typeof t=="number"?g(this,$,H).call(this,e,t,s):g(this,$,H).call(this,e,t));d(this,"text",(e,t,s)=>{if(!a(this,R)){if(a(this,q)&&!s&&!t)return new Response(e);f(this,R,{})}return a(this,R)["content-type"]=Wt,typeof t=="number"?g(this,$,H).call(this,e,t,s):g(this,$,H).call(this,e,t)});d(this,"json",(e,t,s)=>{const r=JSON.stringify(e);return a(this,R)??f(this,R,{}),a(this,R)["content-type"]="application/json",typeof t=="number"?g(this,$,H).call(this,r,t,s):g(this,$,H).call(this,r,t)});d(this,"html",(e,t,s)=>(a(this,R)??f(this,R,{}),a(this,R)["content-type"]="text/html; charset=UTF-8",typeof e=="object"?at(e,Bt.Stringify,!1,{}).then(r=>typeof t=="number"?g(this,$,H).call(this,r,t,s):g(this,$,H).call(this,r,t)):typeof t=="number"?g(this,$,H).call(this,e,t,s):g(this,$,H).call(this,e,t)));d(this,"redirect",(e,t)=>(a(this,m)??f(this,m,new Headers),a(this,m).set("Location",String(e)),this.newResponse(null,t??302)));d(this,"notFound",()=>(a(this,de)??f(this,de,()=>new Response),a(this,de).call(this,this)));f(this,Re,e),t&&(f(this,z,t.executionCtx),this.env=t.env,f(this,de,t.notFoundHandler),f(this,Pe,t.path),f(this,Oe,t.matchResult))}get req(){return a(this,xe)??f(this,xe,new it(a(this,Re),a(this,Pe),a(this,Oe))),a(this,xe)}get event(){if(a(this,z)&&"respondWith"in a(this,z))return a(this,z);throw Error("This context has no FetchEvent")}get executionCtx(){if(a(this,z))return a(this,z);throw Error("This context has no ExecutionContext")}get res(){return f(this,q,!1),a(this,k)||f(this,k,new Response("404 Not Found",{status:404}))}set res(e){if(f(this,q,!1),a(this,k)&&e){e=new Response(e.body,e);for(const[t,s]of a(this,k).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const r=a(this,k).headers.getSetCookie();e.headers.delete("set-cookie");for(const i of r)e.headers.append("set-cookie",i)}else e.headers.set(t,s)}f(this,k,e),this.finalized=!0}get var(){return a(this,W)?Object.fromEntries(a(this,W)):{}}},Re=new WeakMap,xe=new WeakMap,W=new WeakMap,ee=new WeakMap,z=new WeakMap,m=new WeakMap,R=new WeakMap,k=new WeakMap,q=new WeakMap,je=new WeakMap,fe=new WeakMap,de=new WeakMap,Oe=new WeakMap,Pe=new WeakMap,$=new WeakSet,H=function(e,t,s){if(a(this,q)&&!s&&!t&&a(this,ee)===200)return new Response(e,{headers:a(this,R)});if(t&&typeof t!="number"){const i=new Headers(t.headers);a(this,m)&&a(this,m).forEach((c,h)=>{h==="set-cookie"?i.append(h,c):i.set(h,c)});const n=We(i,a(this,R));return new Response(e,{headers:n,status:t.status??a(this,ee)})}const r=typeof t=="number"?t:a(this,ee);a(this,R)??f(this,R,{}),a(this,m)??f(this,m,new Headers),We(a(this,m),a(this,R)),a(this,k)&&(a(this,k).headers.forEach((i,n)=>{var c,h;n==="set-cookie"?(c=a(this,m))==null||c.append(n,i):(h=a(this,m))==null||h.set(n,i)}),We(a(this,m),a(this,R))),s??(s={});for(const[i,n]of Object.entries(s))if(typeof n=="string")a(this,m).set(i,n);else{a(this,m).delete(i);for(const c of n)a(this,m).append(i,c)}return new Response(e,{status:r,headers:a(this,m)})},yt),j="ALL",qt="all",Ut=["get","post","put","delete","options","patch"],ot="Can not add a route since the matcher is already built.",ct=class extends Error{},Kt="__COMPOSED_HANDLER",Vt=e=>e.text("404 Not Found",404),ht=(e,t)=>{if("getResponse"in e){const s=e.getResponse();return t.newResponse(s.body,s)}return console.error(e),t.text("Internal Server Error",500)},lt=(vt=class{constructor(t={}){p(this,O);d(this,"get");d(this,"post");d(this,"put");d(this,"delete");d(this,"options");d(this,"patch");d(this,"all");d(this,"on");d(this,"use");d(this,"router");d(this,"getPath");d(this,"_basePath","/");p(this,L,"/");d(this,"routes",[]);p(this,M,Vt);d(this,"errorHandler",ht);d(this,"onError",t=>(this.errorHandler=t,this));d(this,"notFound",t=>(f(this,M,t),this));d(this,"fetch",(t,...s)=>g(this,O,Te).call(this,t,s[1],s[0],t.method));d(this,"request",(t,s,r,i)=>t instanceof Request?this.fetch(s?new Request(t,s):t,r,i):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${ce("/",t)}`,s),r,i)));d(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(g(this,O,Te).call(this,t.request,t,void 0,t.request.method))})});[...Ut,qt].forEach(n=>{this[n]=(c,...h)=>(typeof c=="string"?f(this,L,c):g(this,O,ie).call(this,n,a(this,L),c),h.forEach(o=>{g(this,O,ie).call(this,n,a(this,L),o)}),this)}),this.on=(n,c,...h)=>{for(const o of[c].flat()){f(this,L,o);for(const l of[n].flat())h.map(u=>{g(this,O,ie).call(this,l.toUpperCase(),a(this,L),u)})}return this},this.use=(n,...c)=>(typeof n=="string"?f(this,L,n):(f(this,L,"*"),c.unshift(n)),c.forEach(h=>{g(this,O,ie).call(this,j,a(this,L),h)}),this);const{strict:r,...i}=t;Object.assign(this,i),this.getPath=r??!0?t.getPath??et:Ft}route(t,s){const r=this.basePath(t);return s.routes.map(i=>{var c;let n;s.errorHandler===ht?n=i.handler:(n=async(h,o)=>(await v([],s.errorHandler)(h,()=>i.handler(h,o))).res,n[Kt]=i.handler),g(c=r,O,ie).call(c,i.method,i.path,n)}),this}basePath(t){const s=g(this,O,Nt).call(this);return s._basePath=ce(this._basePath,t),s}mount(t,s,r){let i,n;r&&(typeof r=="function"?n=r:(n=r.optionHandler,r.replaceRequest===!1?i=o=>o:i=r.replaceRequest));const c=n?o=>{const l=n(o);return Array.isArray(l)?l:[l]}:o=>{let l;try{l=o.executionCtx}catch{}return[o.env,l]};i||(i=(()=>{const o=ce(this._basePath,t),l=o==="/"?0:o.length;return u=>{const w=new URL(u.url);return w.pathname=w.pathname.slice(l)||"/",new Request(w,u)}})());const h=async(o,l)=>{const u=await s(i(o.req.raw),...c(o));if(u)return u;await l()};return g(this,O,ie).call(this,j,ce(t,"*"),h),this}},L=new WeakMap,O=new WeakSet,Nt=function(){const t=new lt({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,f(t,M,a(this,M)),t.routes=this.routes,t},M=new WeakMap,ie=function(t,s,r){t=t.toUpperCase(),s=ce(this._basePath,s);const i={path:s,method:t,handler:r};this.router.add(t,s,[r,i]),this.routes.push(i)},Fe=function(t,s){if(t instanceof Error)return this.errorHandler(t,s);throw t},Te=function(t,s,r,i){if(i==="HEAD")return(async()=>new Response(null,await g(this,O,Te).call(this,t,s,r,"GET")))();const n=this.getPath(t,{env:r}),c=this.router.match(i,n),h=new zt(t,{path:n,matchResult:c,env:r,executionCtx:s,notFoundHandler:a(this,M)});if(c[0].length===1){let l;try{l=c[0][0][0][0](h,async()=>{h.res=await a(this,M).call(this,h)})}catch(u){return g(this,O,Fe).call(this,u,h)}return l instanceof Promise?l.then(u=>u||(h.finalized?h.res:a(this,M).call(this,h))).catch(u=>g(this,O,Fe).call(this,u,h)):l??a(this,M).call(this,h)}const o=v(c[0],this.errorHandler,a(this,M));return(async()=>{try{const l=await o(h);if(!l.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return l.res}catch(l){return g(this,O,Fe).call(this,l,h)}})()},vt),Ne="[^/]+",ve=".*",be="(?:|/.*)",me=Symbol(),Gt=new Set(".\\+*[^]$()");function Jt(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===ve||e===be?1:t===ve||t===be?-1:e===Ne?1:t===Ne?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var ze=(bt=class{constructor(){p(this,te);p(this,se);p(this,F,Object.create(null))}insert(t,s,r,i,n){if(t.length===0){if(a(this,te)!==void 0)throw me;if(n)return;f(this,te,s);return}const[c,...h]=t,o=c==="*"?h.length===0?["","",ve]:["","",Ne]:c==="/*"?["","",be]:c.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let l;if(o){const u=o[1];let w=o[2]||Ne;if(u&&o[2]&&(w=w.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(w)))throw me;if(l=a(this,F)[w],!l){if(Object.keys(a(this,F)).some(y=>y!==ve&&y!==be))throw me;if(n)return;l=a(this,F)[w]=new ze,u!==""&&f(l,se,i.varIndex++)}!n&&u!==""&&r.push([u,a(l,se)])}else if(l=a(this,F)[c],!l){if(Object.keys(a(this,F)).some(u=>u.length>1&&u!==ve&&u!==be))throw me;if(n)return;l=a(this,F)[c]=new ze}l.insert(h,s,r,i,n)}buildRegExpStr(){const s=Object.keys(a(this,F)).sort(Jt).map(r=>{const i=a(this,F)[r];return(typeof a(i,se)=="number"?`(${r})@${a(i,se)}`:Gt.has(r)?`\\${r}`:r)+i.buildRegExpStr()});return typeof a(this,te)=="number"&&s.unshift(`#${a(this,te)}`),s.length===0?"":s.length===1?s[0]:"(?:"+s.join("|")+")"}},te=new WeakMap,se=new WeakMap,F=new WeakMap,bt),Xt=(mt=class{constructor(){p(this,Le,{varIndex:0});p(this,Ie,new ze)}insert(e,t,s){const r=[],i=[];for(let c=0;;){let h=!1;if(e=e.replace(/\{[^}]+\}/g,o=>{const l=`@\\${c}`;return i[c]=[l,o],c++,h=!0,l}),!h)break}const n=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let c=i.length-1;c>=0;c--){const[h]=i[c];for(let o=n.length-1;o>=0;o--)if(n[o].indexOf(h)!==-1){n[o]=n[o].replace(h,i[c][1]);break}}return a(this,Ie).insert(n,t,r,a(this,Le),s),r}buildRegExp(){let e=a(this,Ie).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const s=[],r=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(i,n,c)=>n!==void 0?(s[++t]=Number(n),"$()"):(c!==void 0&&(r[Number(c)]=++t),"")),[new RegExp(`^${e}`),s,r]}},Le=new WeakMap,Ie=new WeakMap,mt),ut=[],Qt=[/^$/,[],Object.create(null)],ke=Object.create(null);function ft(e){return ke[e]??(ke[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,s)=>s?`\\${s}`:"(?:|/.*)")}$`))}function Yt(){ke=Object.create(null)}function Zt(e){var l;const t=new Xt,s=[];if(e.length===0)return Qt;const r=e.map(u=>[!/\*|\/:/.test(u[0]),...u]).sort(([u,w],[y,P])=>u?1:y?-1:w.length-P.length),i=Object.create(null);for(let u=0,w=-1,y=r.length;u<y;u++){const[P,S,x]=r[u];P?i[S]=[x.map(([A])=>[A,Object.create(null)]),ut]:w++;let N;try{N=t.insert(S,w,P)}catch(A){throw A===me?new ct(S):A}P||(s[w]=x.map(([A,ye])=>{const Ce=Object.create(null);for(ye-=1;ye>=0;ye--){const[T,Ve]=N[ye];Ce[T]=Ve}return[A,Ce]}))}const[n,c,h]=t.buildRegExp();for(let u=0,w=s.length;u<w;u++)for(let y=0,P=s[u].length;y<P;y++){const S=(l=s[u][y])==null?void 0:l[1];if(!S)continue;const x=Object.keys(S);for(let N=0,A=x.length;N<A;N++)S[x[N]]=h[S[x[N]]]}const o=[];for(const u in c)o[u]=s[c[u]];return[n,o,i]}function he(e,t){if(e){for(const s of Object.keys(e).sort((r,i)=>i.length-r.length))if(ft(s).test(t))return[...e[s]]}}var es=(Et=class{constructor(){p(this,pe);d(this,"name","RegExpRouter");p(this,J);p(this,X);f(this,J,{[j]:Object.create(null)}),f(this,X,{[j]:Object.create(null)})}add(e,t,s){var h;const r=a(this,J),i=a(this,X);if(!r||!i)throw new Error(ot);r[e]||[r,i].forEach(o=>{o[e]=Object.create(null),Object.keys(o[j]).forEach(l=>{o[e][l]=[...o[j][l]]})}),t==="/*"&&(t="*");const n=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const o=ft(t);e===j?Object.keys(r).forEach(l=>{var u;(u=r[l])[t]||(u[t]=he(r[l],t)||he(r[j],t)||[])}):(h=r[e])[t]||(h[t]=he(r[e],t)||he(r[j],t)||[]),Object.keys(r).forEach(l=>{(e===j||e===l)&&Object.keys(r[l]).forEach(u=>{o.test(u)&&r[l][u].push([s,n])})}),Object.keys(i).forEach(l=>{(e===j||e===l)&&Object.keys(i[l]).forEach(u=>o.test(u)&&i[l][u].push([s,n]))});return}const c=tt(t)||[t];for(let o=0,l=c.length;o<l;o++){const u=c[o];Object.keys(i).forEach(w=>{var y;(e===j||e===w)&&((y=i[w])[u]||(y[u]=[...he(r[w],u)||he(r[j],u)||[]]),i[w][u].push([s,n-l+o+1]))})}}match(e,t){Yt();const s=g(this,pe,kt).call(this);return this.match=(r,i)=>{const n=s[r]||s[j],c=n[2][i];if(c)return c;const h=i.match(n[0]);if(!h)return[[],ut];const o=h.indexOf("",1);return[n[1][o],h]},this.match(e,t)}},J=new WeakMap,X=new WeakMap,pe=new WeakSet,kt=function(){const e=Object.create(null);return Object.keys(a(this,X)).concat(Object.keys(a(this,J))).forEach(t=>{e[t]||(e[t]=g(this,pe,St).call(this,t))}),f(this,J,f(this,X,void 0)),e},St=function(e){const t=[];let s=e===j;return[a(this,J),a(this,X)].forEach(r=>{const i=r[e]?Object.keys(r[e]).map(n=>[n,r[e][n]]):[];i.length!==0?(s||(s=!0),t.push(...i)):e!==j&&t.push(...Object.keys(r[j]).map(n=>[n,r[j][n]]))}),s?Zt(t):null},Et),ts=(Rt=class{constructor(e){d(this,"name","SmartRouter");p(this,Q,[]);p(this,U,[]);f(this,Q,e.routers)}add(e,t,s){if(!a(this,U))throw new Error(ot);a(this,U).push([e,t,s])}match(e,t){if(!a(this,U))throw new Error("Fatal error");const s=a(this,Q),r=a(this,U),i=s.length;let n=0,c;for(;n<i;n++){const h=s[n];try{for(let o=0,l=r.length;o<l;o++)h.add(...r[o]);c=h.match(e,t)}catch(o){if(o instanceof ct)continue;throw o}this.match=h.match.bind(h),f(this,Q,[h]),f(this,U,void 0);break}if(n===i)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,c}get activeRouter(){if(a(this,U)||a(this,Q).length!==1)throw new Error("No active router has been determined yet.");return a(this,Q)[0]}},Q=new WeakMap,U=new WeakMap,Rt),Ee=Object.create(null),dt=(xt=class{constructor(e,t,s){p(this,K);p(this,Y);p(this,C);p(this,re);p(this,ge,0);p(this,I,Ee);if(f(this,C,s||Object.create(null)),f(this,Y,[]),e&&t){const r=Object.create(null);r[e]={handler:t,possibleKeys:[],score:0},f(this,Y,[r])}f(this,re,[])}insert(e,t,s){f(this,ge,++It(this,ge)._);let r=this;const i=Ht(t),n=[];for(let o=0,l=i.length;o<l;o++){const u=i[o],w=i[o+1],y=Ye(u,w),P=Array.isArray(y)?y[0]:u;if(Object.keys(a(r,C)).includes(P)){r=a(r,C)[P];const S=Ye(u,w);S&&n.push(S[1]);continue}a(r,C)[P]=new dt,y&&(a(r,re).push(y),n.push(y[1])),r=a(r,C)[P]}const c=Object.create(null),h={handler:s,possibleKeys:n.filter((o,l,u)=>u.indexOf(o)===l),score:a(this,ge)};return c[e]=h,a(r,Y).push(c),r}search(e,t){var h;const s=[];f(this,I,Ee);let i=[this];const n=Qe(t),c=[];for(let o=0,l=n.length;o<l;o++){const u=n[o],w=o===l-1,y=[];for(let P=0,S=i.length;P<S;P++){const x=i[P],N=a(x,C)[u];N&&(f(N,I,a(x,I)),w?(a(N,C)["*"]&&s.push(...g(this,K,ae).call(this,a(N,C)["*"],e,a(x,I))),s.push(...g(this,K,ae).call(this,N,e,a(x,I)))):y.push(N));for(let A=0,ye=a(x,re).length;A<ye;A++){const Ce=a(x,re)[A],T=a(x,I)===Ee?{}:{...a(x,I)};if(Ce==="*"){const Z=a(x,C)["*"];Z&&(s.push(...g(this,K,ae).call(this,Z,e,a(x,I))),f(Z,I,T),y.push(Z));continue}if(u==="")continue;const[Ve,Ot,Me]=Ce,V=a(x,C)[Ve],cs=n.slice(o).join("/");if(Me instanceof RegExp){const Z=Me.exec(cs);if(Z){if(T[Ot]=Z[0],s.push(...g(this,K,ae).call(this,V,e,a(x,I),T)),Object.keys(a(V,C)).length){f(V,I,T);const Ge=((h=Z[0].match(/\//))==null?void 0:h.length)??0;(c[Ge]||(c[Ge]=[])).push(V)}continue}}(Me===!0||Me.test(u))&&(T[Ot]=u,w?(s.push(...g(this,K,ae).call(this,V,e,T,a(x,I))),a(V,C)["*"]&&s.push(...g(this,K,ae).call(this,a(V,C)["*"],e,T,a(x,I)))):(f(V,I,T),y.push(V)))}}i=y.concat(c.shift()??[])}return s.length>1&&s.sort((o,l)=>o.score-l.score),[s.map(({handler:o,params:l})=>[o,l])]}},Y=new WeakMap,C=new WeakMap,re=new WeakMap,ge=new WeakMap,I=new WeakMap,K=new WeakSet,ae=function(e,t,s,r){const i=[];for(let n=0,c=a(e,Y).length;n<c;n++){const h=a(e,Y)[n],o=h[t]||h[j],l={};if(o!==void 0&&(o.params=Object.create(null),i.push(o),s!==Ee||r&&r!==Ee))for(let u=0,w=o.possibleKeys.length;u<w;u++){const y=o.possibleKeys[u],P=l[o.score];o.params[y]=r!=null&&r[y]&&!P?r[y]:s[y]??(r==null?void 0:r[y]),l[o.score]=!0}}return i},xt),ss=(jt=class{constructor(){d(this,"name","TrieRouter");p(this,ne);f(this,ne,new dt)}add(e,t,s){const r=tt(t);if(r){for(let i=0,n=r.length;i<n;i++)a(this,ne).insert(e,r[i],s);return}a(this,ne).insert(e,t,s)}match(e,t){return a(this,ne).search(e,t)}},ne=new WeakMap,jt),rs=class extends lt{constructor(e={}){super(e),this.router=e.router??new ts({routers:[new es,new ss]})}},ns=(e,t={fetch:globalThis.fetch.bind(globalThis)})=>s=>{s.respondWith((async()=>{const r=await e.fetch(s.request);return t.fetch&&r.status===404?await t.fetch(s.request):r})())};class le{constructor(t){d(this,"state","pending");d(this,"value");d(this,"reason");d(this,"onFulfilledCallbacks",[]);d(this,"onRejectedCallbacks",[]);const s=i=>{this.state==="pending"&&(this.state="fulfilled",this.value=i,this.onFulfilledCallbacks.forEach(n=>n()))},r=i=>{this.state==="pending"&&(this.state="rejected",this.reason=i,this.onRejectedCallbacks.forEach(n=>n()))};try{t(s,r)}catch(i){r(i)}}then(t,s){return new le((r,i)=>{if(this.state==="fulfilled")try{const n=t?t(this.value):this.value;r(n)}catch(n){i(n)}else if(this.state==="rejected")try{const n=s?s(this.reason):this.reason;r(n)}catch(n){i(n)}else this.state==="pending"&&(this.onFulfilledCallbacks.push(()=>{try{const n=t?t(this.value):this.value;r(n)}catch(n){i(n)}}),this.onRejectedCallbacks.push(()=>{try{const n=s?s(this.reason):this.reason;r(n)}catch(n){i(n)}}))})}}async function is(e){const t=e.headers.get("Content-Type");let s;switch(t){case"application/json":s="json";break;case"application/octet-stream":s="arrayBuffer";break;case"text/number":s="number";break;case"text/boolean":s="boolean";break;default:s="text";break}switch(s){case"number":return Number(await e.text());case"json":return e.json();case"arrayBuffer":return e.arrayBuffer();case"blob":return e.blob();case"text":return e.text();case"boolean":return await e.text()==="1";default:return e.body}}const we=class we{constructor({cachePrefix:t="app",cacheNamespace:s="default",broadId:r="global"}={}){d(this,"cachePrefix");d(this,"cacheNamespace");d(this,"broadId");d(this,"cacheName");d(this,"cache");d(this,"isInitialized",!1);if(we.instance)return we.instance;this.cachePrefix=t,this.cacheNamespace=s,this.broadId=r,this.cacheName=`${this.cachePrefix}-${this.cacheNamespace}-${this.broadId}`,we.instance=this}init(){return new le(async(t,s)=>{try{this.cache=await caches.open(this.cacheName),this.isInitialized=!0,t(this.cache)}catch(r){this.handleError(r),s(r)}})}setItem(t,s,r="text/plain"){return new le(async(i,n)=>{var c;if(!this.isInitialized){const h=new Error("CacheManager is not initialized. Call init() before using setItem.");this.handleError(h),n(h);return}try{const h=new Response(JSON.stringify(s),{headers:{"Content-Type":r}});await((c=this.cache)==null?void 0:c.put(t,h)),i(!0)}catch(h){this.handleError(h),n(h)}})}getItem(t){return new le(async(s,r)=>{var i;if(!this.isInitialized){const n=new Error("CacheManager is not initialized. Call init() before using getItem.");this.handleError(n),r(n);return}try{const n=await((i=this.cache)==null?void 0:i.match(t));if(!n){s(null);return}const c=await is(n);s(c)}catch(n){this.handleError(n),r(n)}})}removeItem(t){return new le(async(s,r)=>{var i;if(!this.isInitialized){const n=new Error("CacheManager is not initialized. Call init() before using removeItem.");this.handleError(n),r(n);return}try{await((i=this.cache)==null?void 0:i.delete(t)),s(!0)}catch(n){this.handleError(n),r(n)}})}handleError(t){throw new Error(t.stack||t)}};d(we,"instance");let qe=we;const Se=new qe({cachePrefix:"FloatBlog",cacheNamespace:"ConfigData",broadId:"service-worker"}),Ae={instance:null},Ue=async()=>{if(Ae.instance)return Ae.instance;try{return await Se.init(),Ae.instance=Se,Se}catch(e){console.error("Init cache failed:",e)}},pt=async e=>{if(Ae.instance)try{return await Se.getItem(e)!==null}catch{return!1}else throw new Error("CacheManager is not initialized. Call init() before using hasItem.")},_={registryBaseUrl:"https://registry.npmmirror.com/",packageName:"@floatsheep/fsl-blog",blogDomain:"blog.hesiy.cn",serviceWorkerName:"sw.js",localMode:!1},Ke=new rs;let He;Ue().then(e=>{He=e});const as=e=>{if(e.endsWith(".html")){const t=e.split("/").pop(),s=t.slice(0,t.lastIndexOf("."));return e.replace(t,`${s}-html.json`)}return e},gt=async e=>{var r;e.endsWith("/")&&(e+="index.html"),e=as(e);const t=((r=await(He==null?void 0:He.getItem("version")))==null?void 0:r.split('"')[1])||"",s=`${_.registryBaseUrl}${_.packageName}/${t}/files${e}`;return fetch(s)};Ke.get("*",async e=>{let t=e.req.path;const s=await gt(t);return s.url.includes(".svg")&&e.header("Content-Type","image/svg+xml"),s.status===404?e.notFound():e.body(await s.arrayBuffer())}),Ke.notFound(async e=>e.body(await(await gt("/404.html")).arrayBuffer(),404));const os=ns(Ke),De={isChecked:!1};addEventListener("install",()=>{Ue().then(async e=>{if(!De.isChecked){const t=await(await fetch(`${_.registryBaseUrl}${_.packageName}/latest`,{cache:"no-store"})).json();De.isChecked=!0,await pt("version")?await e.getItem("version")<Number(t.version.split("")[1])&&await e.setItem("version",t.version):await e.setItem("version",t.version)}})}),self.addEventListener("fetch",e=>{if((e.request.url.includes(_.blogDomain)||_.localMode)&&!e.request.url.includes(_.serviceWorkerName)&&e.request.url.startsWith(self.location.origin))return Ue().then(async t=>{if(!De.isChecked){const s=await(await fetch(`${_.registryBaseUrl}${_.packageName}/latest`)).json();De.isChecked=!0,await pt("version")?await t.getItem("version")<Number(s.version.split("")[1])&&await t.setItem("version",s.version):await t.setItem("version",s.version)}}),os(e);e.respondWith(fetch(e.request))})})();
