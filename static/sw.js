var lr=Object.defineProperty;var jt=y=>{throw TypeError(y)};var ur=(y,v,E)=>v in y?lr(y,v,{enumerable:!0,configurable:!0,writable:!0,value:E}):y[v]=E;var d=(y,v,E)=>ur(y,typeof v!="symbol"?v+"":v,E),Ke=(y,v,E)=>v.has(y)||jt("Cannot "+E);var a=(y,v,E)=>(Ke(y,v,"read from private field"),E?E.call(y):v.get(y)),p=(y,v,E)=>v.has(y)?jt("Cannot add the same private member more than once"):v instanceof WeakSet?v.add(y):v.set(y,E),f=(y,v,E,ae)=>(Ke(y,v,"write to private field"),ae?ae.call(y,E):v.set(y,E),E),g=(y,v,E)=>(Ke(y,v,"access private method"),E);var Pt=(y,v,E,ae)=>({set _(Fe){f(y,v,Fe,E)},get _(){return a(y,v,ae)}});(function(){"use strict";var le,D,_,Ct,It,Ve,V,gt,Ee,Re,W,Z,B,m,R,k,q,xe,ue,fe,Oe,je,$,H,wt,L,j,$t,M,ne,Le,Me,yt,ee,te,F,bt,He,Pe,vt,G,J,de,Nt,kt,mt,X,z,Et,Q,I,re,pe,C,U,ie,Rt,se,xt;const y={registryBaseUrl:"https://registry.npmmirror.com/",packageName:"@floatsheep/fsl-blog",blogDomain:"blog.hesiy.cn",serviceWorkerName:"sw.js",localMode:!1};var v=(e,t,r)=>(s,i)=>{let n=-1;return c(0);async function c(h){if(h<=n)throw new Error("next() called multiple times");n=h;let o,l=!1,u;if(e[h]?(u=e[h][0][0],s.req.routeIndex=h):u=h===e.length&&i||void 0,u)try{o=await u(s,()=>c(h+1))}catch(w){if(w instanceof Error&&t)s.error=w,o=await t(w,s),l=!0;else throw w}else s.finalized===!1&&r&&(o=await r(s));return o&&(s.finalized===!1||l)&&(s.res=o),s}},E=async(e,t=Object.create(null))=>{const{all:r=!1,dot:s=!1}=t,n=(e instanceof rt?e.raw.headers:e.headers).get("Content-Type");return n!=null&&n.startsWith("multipart/form-data")||n!=null&&n.startsWith("application/x-www-form-urlencoded")?ae(e,{all:r,dot:s}):{}};async function ae(e,t){const r=await e.formData();return r?Fe(r,t):{}}function Fe(e,t){const r=Object.create(null);return e.forEach((s,i)=>{t.all||i.endsWith("[]")?St(r,i,s):r[i]=s}),t.dot&&Object.entries(r).forEach(([s,i])=>{s.includes(".")&&(At(r,s,i),delete r[s])}),r}var St=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:e[t]=r},At=(e,t,r)=>{let s=e;const i=t.split(".");i.forEach((n,c)=>{c===i.length-1?s[n]=r:((!s[n]||typeof s[n]!="object"||Array.isArray(s[n])||s[n]instanceof File)&&(s[n]=Object.create(null)),s=s[n])})},Ge=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},Ht=e=>{const{groups:t,path:r}=Dt(e),s=Ge(r);return Lt(s,t)},Dt=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,s)=>{const i=`@${s}`;return t.push([i,r]),i}),{groups:t,path:e}},Lt=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[s]=t[r];for(let i=e.length-1;i>=0;i--)if(e[i].includes(s)){e[i]=e[i].replace(s,t[r][1]);break}}return e},Ie={},Je=(e,t)=>{if(e==="*")return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const s=`${e}#${t}`;return Ie[s]||(r[2]?Ie[s]=t&&t[0]!==":"&&t[0]!=="*"?[s,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:Ie[s]=[e,r[1],!0]),Ie[s]}return null},Xe=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},Mt=e=>Xe(e,decodeURI),Qe=e=>{const t=e.url,r=t.indexOf("/",8);let s=r;for(;s<t.length;s++){const i=t.charCodeAt(s);if(i===37){const n=t.indexOf("?",s),c=t.slice(r,n===-1?void 0:n);return Mt(c.includes("%25")?c.replace(/%25/g,"%2525"):c)}else if(i===63)break}return t.slice(r,s)},Ft=e=>{const t=Qe(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},oe=(e,t,...r)=>(r.length&&(t=oe(t,...r)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),Ye=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),r=[];let s="";return t.forEach(i=>{if(i!==""&&!/\:/.test(i))s+="/"+i;else if(/\:/.test(i))if(/\?/.test(i)){r.length===0&&s===""?r.push("/"):r.push(s);const n=i.replace("?","");s+="/"+n,r.push(s)}else s+="/"+i}),r.filter((i,n,c)=>c.indexOf(i)===n)},Te=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?et(e):e):e,Ze=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let c=e.indexOf(`?${t}`,8);for(c===-1&&(c=e.indexOf(`&${t}`,8));c!==-1;){const h=e.charCodeAt(c+t.length+1);if(h===61){const o=c+t.length+2,l=e.indexOf("&",o);return Te(e.slice(o,l===-1?void 0:l))}else if(h==38||isNaN(h))return"";c=e.indexOf(`&${t}`,c+1)}if(s=/[%+]/.test(e),!s)return}const i={};s??(s=/[%+]/.test(e));let n=e.indexOf("?",8);for(;n!==-1;){const c=e.indexOf("&",n+1);let h=e.indexOf("=",n);h>c&&c!==-1&&(h=-1);let o=e.slice(n+1,h===-1?c===-1?void 0:c:h);if(s&&(o=Te(o)),n=c,o==="")continue;let l;h===-1?l="":(l=e.slice(h+1,c===-1?void 0:c),s&&(l=Te(l))),r?(i[o]&&Array.isArray(i[o])||(i[o]=[]),i[o].push(l)):i[o]??(i[o]=l)}return t?i[t]:i},Tt=Ze,_t=(e,t)=>Ze(e,t,!0),et=decodeURIComponent,tt=e=>Xe(e,et),rt=(gt=class{constructor(e,t="/",r=[[]]){p(this,_);d(this,"raw");p(this,le);p(this,D);d(this,"routeIndex",0);d(this,"path");d(this,"bodyCache",{});p(this,V,e=>{const{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;const i=Object.keys(t)[0];return i?t[i].then(n=>(i==="json"&&(n=JSON.stringify(n)),new Response(n)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,f(this,D,r),f(this,le,{})}param(e){return e?g(this,_,Ct).call(this,e):g(this,_,It).call(this)}query(e){return Tt(this.url,e)}queries(e){return _t(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((r,s)=>{t[s]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await E(this,e))}json(){return a(this,V).call(this,"json")}text(){return a(this,V).call(this,"text")}arrayBuffer(){return a(this,V).call(this,"arrayBuffer")}blob(){return a(this,V).call(this,"blob")}formData(){return a(this,V).call(this,"formData")}addValidatedData(e,t){a(this,le)[e]=t}valid(e){return a(this,le)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return a(this,D)[0].map(([[,e]])=>e)}get routePath(){return a(this,D)[0].map(([[,e]])=>e)[this.routeIndex].path}},le=new WeakMap,D=new WeakMap,_=new WeakSet,Ct=function(e){const t=a(this,D)[0][this.routeIndex][1][e],r=g(this,_,Ve).call(this,t);return r?/\%/.test(r)?tt(r):r:void 0},It=function(){const e={},t=Object.keys(a(this,D)[0][this.routeIndex][1]);for(const r of t){const s=g(this,_,Ve).call(this,a(this,D)[0][this.routeIndex][1][r]);s&&typeof s=="string"&&(e[r]=/\%/.test(s)?tt(s):s)}return e},Ve=function(e){return a(this,D)[1]?a(this,D)[1][e]:e},V=new WeakMap,gt),Wt={Stringify:1},st=async(e,t,r,s,i)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const n=e.callbacks;return n!=null&&n.length?(i?i[0]+=e:i=[e],Promise.all(n.map(h=>h({phase:t,buffer:i,context:s}))).then(h=>Promise.all(h.filter(Boolean).map(o=>st(o,t,!1,s,i))).then(()=>i[0]))):Promise.resolve(e)},Bt="text/plain; charset=UTF-8",_e=(e,t={})=>{for(const r of Object.keys(t))e.set(r,t[r]);return e},qt=(wt=class{constructor(e,t){p(this,$);p(this,Ee);p(this,Re);d(this,"env",{});p(this,W);d(this,"finalized",!1);d(this,"error");p(this,Z,200);p(this,B);p(this,m);p(this,R);p(this,k);p(this,q,!0);p(this,xe);p(this,ue);p(this,fe);p(this,Oe);p(this,je);d(this,"render",(...e)=>(a(this,ue)??f(this,ue,t=>this.html(t)),a(this,ue).call(this,...e)));d(this,"setLayout",e=>f(this,xe,e));d(this,"getLayout",()=>a(this,xe));d(this,"setRenderer",e=>{f(this,ue,e)});d(this,"header",(e,t,r)=>{if(this.finalized&&f(this,k,new Response(a(this,k).body,a(this,k))),t===void 0){a(this,m)?a(this,m).delete(e):a(this,R)&&delete a(this,R)[e.toLocaleLowerCase()],this.finalized&&this.res.headers.delete(e);return}r!=null&&r.append?(a(this,m)||(f(this,q,!1),f(this,m,new Headers(a(this,R))),f(this,R,{})),a(this,m).append(e,t)):a(this,m)?a(this,m).set(e,t):(a(this,R)??f(this,R,{}),a(this,R)[e.toLowerCase()]=t),this.finalized&&(r!=null&&r.append?this.res.headers.append(e,t):this.res.headers.set(e,t))});d(this,"status",e=>{f(this,q,!1),f(this,Z,e)});d(this,"set",(e,t)=>{a(this,W)??f(this,W,new Map),a(this,W).set(e,t)});d(this,"get",e=>a(this,W)?a(this,W).get(e):void 0);d(this,"newResponse",(...e)=>g(this,$,H).call(this,...e));d(this,"body",(e,t,r)=>typeof t=="number"?g(this,$,H).call(this,e,t,r):g(this,$,H).call(this,e,t));d(this,"text",(e,t,r)=>{if(!a(this,R)){if(a(this,q)&&!r&&!t)return new Response(e);f(this,R,{})}return a(this,R)["content-type"]=Bt,typeof t=="number"?g(this,$,H).call(this,e,t,r):g(this,$,H).call(this,e,t)});d(this,"json",(e,t,r)=>{const s=JSON.stringify(e);return a(this,R)??f(this,R,{}),a(this,R)["content-type"]="application/json",typeof t=="number"?g(this,$,H).call(this,s,t,r):g(this,$,H).call(this,s,t)});d(this,"html",(e,t,r)=>(a(this,R)??f(this,R,{}),a(this,R)["content-type"]="text/html; charset=UTF-8",typeof e=="object"?st(e,Wt.Stringify,!1,{}).then(s=>typeof t=="number"?g(this,$,H).call(this,s,t,r):g(this,$,H).call(this,s,t)):typeof t=="number"?g(this,$,H).call(this,e,t,r):g(this,$,H).call(this,e,t)));d(this,"redirect",(e,t)=>(a(this,m)??f(this,m,new Headers),a(this,m).set("Location",String(e)),this.newResponse(null,t??302)));d(this,"notFound",()=>(a(this,fe)??f(this,fe,()=>new Response),a(this,fe).call(this,this)));f(this,Ee,e),t&&(f(this,B,t.executionCtx),this.env=t.env,f(this,fe,t.notFoundHandler),f(this,je,t.path),f(this,Oe,t.matchResult))}get req(){return a(this,Re)??f(this,Re,new rt(a(this,Ee),a(this,je),a(this,Oe))),a(this,Re)}get event(){if(a(this,B)&&"respondWith"in a(this,B))return a(this,B);throw Error("This context has no FetchEvent")}get executionCtx(){if(a(this,B))return a(this,B);throw Error("This context has no ExecutionContext")}get res(){return f(this,q,!1),a(this,k)||f(this,k,new Response("404 Not Found",{status:404}))}set res(e){if(f(this,q,!1),a(this,k)&&e){e=new Response(e.body,e);for(const[t,r]of a(this,k).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const s=a(this,k).headers.getSetCookie();e.headers.delete("set-cookie");for(const i of s)e.headers.append("set-cookie",i)}else e.headers.set(t,r)}f(this,k,e),this.finalized=!0}get var(){return a(this,W)?Object.fromEntries(a(this,W)):{}}},Ee=new WeakMap,Re=new WeakMap,W=new WeakMap,Z=new WeakMap,B=new WeakMap,m=new WeakMap,R=new WeakMap,k=new WeakMap,q=new WeakMap,xe=new WeakMap,ue=new WeakMap,fe=new WeakMap,Oe=new WeakMap,je=new WeakMap,$=new WeakSet,H=function(e,t,r){if(a(this,q)&&!r&&!t&&a(this,Z)===200)return new Response(e,{headers:a(this,R)});if(t&&typeof t!="number"){const i=new Headers(t.headers);a(this,m)&&a(this,m).forEach((c,h)=>{h==="set-cookie"?i.append(h,c):i.set(h,c)});const n=_e(i,a(this,R));return new Response(e,{headers:n,status:t.status??a(this,Z)})}const s=typeof t=="number"?t:a(this,Z);a(this,R)??f(this,R,{}),a(this,m)??f(this,m,new Headers),_e(a(this,m),a(this,R)),a(this,k)&&(a(this,k).headers.forEach((i,n)=>{var c,h;n==="set-cookie"?(c=a(this,m))==null||c.append(n,i):(h=a(this,m))==null||h.set(n,i)}),_e(a(this,m),a(this,R))),r??(r={});for(const[i,n]of Object.entries(r))if(typeof n=="string")a(this,m).set(i,n);else{a(this,m).delete(i);for(const c of n)a(this,m).append(i,c)}return new Response(e,{status:s,headers:a(this,m)})},wt),O="ALL",zt="all",Ut=["get","post","put","delete","options","patch"],nt="Can not add a route since the matcher is already built.",it=class extends Error{},Kt="__COMPOSED_HANDLER",Vt=e=>e.text("404 Not Found",404),at=(e,t)=>{if("getResponse"in e){const r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},ot=(yt=class{constructor(t={}){p(this,j);d(this,"get");d(this,"post");d(this,"put");d(this,"delete");d(this,"options");d(this,"patch");d(this,"all");d(this,"on");d(this,"use");d(this,"router");d(this,"getPath");d(this,"_basePath","/");p(this,L,"/");d(this,"routes",[]);p(this,M,Vt);d(this,"errorHandler",at);d(this,"onError",t=>(this.errorHandler=t,this));d(this,"notFound",t=>(f(this,M,t),this));d(this,"fetch",(t,...r)=>g(this,j,Me).call(this,t,r[1],r[0],t.method));d(this,"request",(t,r,s,i)=>t instanceof Request?this.fetch(r?new Request(t,r):t,s,i):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${oe("/",t)}`,r),s,i)));d(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(g(this,j,Me).call(this,t.request,t,void 0,t.request.method))})});[...Ut,zt].forEach(n=>{this[n]=(c,...h)=>(typeof c=="string"?f(this,L,c):g(this,j,ne).call(this,n,a(this,L),c),h.forEach(o=>{g(this,j,ne).call(this,n,a(this,L),o)}),this)}),this.on=(n,c,...h)=>{for(const o of[c].flat()){f(this,L,o);for(const l of[n].flat())h.map(u=>{g(this,j,ne).call(this,l.toUpperCase(),a(this,L),u)})}return this},this.use=(n,...c)=>(typeof n=="string"?f(this,L,n):(f(this,L,"*"),c.unshift(n)),c.forEach(h=>{g(this,j,ne).call(this,O,a(this,L),h)}),this);const{strict:s,...i}=t;Object.assign(this,i),this.getPath=s??!0?t.getPath??Qe:Ft}route(t,r){const s=this.basePath(t);return r.routes.map(i=>{var c;let n;r.errorHandler===at?n=i.handler:(n=async(h,o)=>(await v([],r.errorHandler)(h,()=>i.handler(h,o))).res,n[Kt]=i.handler),g(c=s,j,ne).call(c,i.method,i.path,n)}),this}basePath(t){const r=g(this,j,$t).call(this);return r._basePath=oe(this._basePath,t),r}mount(t,r,s){let i,n;s&&(typeof s=="function"?n=s:(n=s.optionHandler,s.replaceRequest===!1?i=o=>o:i=s.replaceRequest));const c=n?o=>{const l=n(o);return Array.isArray(l)?l:[l]}:o=>{let l;try{l=o.executionCtx}catch{}return[o.env,l]};i||(i=(()=>{const o=oe(this._basePath,t),l=o==="/"?0:o.length;return u=>{const w=new URL(u.url);return w.pathname=w.pathname.slice(l)||"/",new Request(w,u)}})());const h=async(o,l)=>{const u=await r(i(o.req.raw),...c(o));if(u)return u;await l()};return g(this,j,ne).call(this,O,oe(t,"*"),h),this}},L=new WeakMap,j=new WeakSet,$t=function(){const t=new ot({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,f(t,M,a(this,M)),t.routes=this.routes,t},M=new WeakMap,ne=function(t,r,s){t=t.toUpperCase(),r=oe(this._basePath,r);const i={path:r,method:t,handler:s};this.router.add(t,r,[s,i]),this.routes.push(i)},Le=function(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t},Me=function(t,r,s,i){if(i==="HEAD")return(async()=>new Response(null,await g(this,j,Me).call(this,t,r,s,"GET")))();const n=this.getPath(t,{env:s}),c=this.router.match(i,n),h=new qt(t,{path:n,matchResult:c,env:s,executionCtx:r,notFoundHandler:a(this,M)});if(c[0].length===1){let l;try{l=c[0][0][0][0](h,async()=>{h.res=await a(this,M).call(this,h)})}catch(u){return g(this,j,Le).call(this,u,h)}return l instanceof Promise?l.then(u=>u||(h.finalized?h.res:a(this,M).call(this,h))).catch(u=>g(this,j,Le).call(this,u,h)):l??a(this,M).call(this,h)}const o=v(c[0],this.errorHandler,a(this,M));return(async()=>{try{const l=await o(h);if(!l.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return l.res}catch(l){return g(this,j,Le).call(this,l,h)}})()},yt),$e="[^/]+",ye=".*",be="(?:|/.*)",ve=Symbol(),Gt=new Set(".\\+*[^]$()");function Jt(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===ye||e===be?1:t===ye||t===be?-1:e===$e?1:t===$e?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var We=(bt=class{constructor(){p(this,ee);p(this,te);p(this,F,Object.create(null))}insert(t,r,s,i,n){if(t.length===0){if(a(this,ee)!==void 0)throw ve;if(n)return;f(this,ee,r);return}const[c,...h]=t,o=c==="*"?h.length===0?["","",ye]:["","",$e]:c==="/*"?["","",be]:c.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let l;if(o){const u=o[1];let w=o[2]||$e;if(u&&o[2]&&(w=w.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(w)))throw ve;if(l=a(this,F)[w],!l){if(Object.keys(a(this,F)).some(b=>b!==ye&&b!==be))throw ve;if(n)return;l=a(this,F)[w]=new We,u!==""&&f(l,te,i.varIndex++)}!n&&u!==""&&s.push([u,a(l,te)])}else if(l=a(this,F)[c],!l){if(Object.keys(a(this,F)).some(u=>u.length>1&&u!==ye&&u!==be))throw ve;if(n)return;l=a(this,F)[c]=new We}l.insert(h,r,s,i,n)}buildRegExpStr(){const r=Object.keys(a(this,F)).sort(Jt).map(s=>{const i=a(this,F)[s];return(typeof a(i,te)=="number"?`(${s})@${a(i,te)}`:Gt.has(s)?`\\${s}`:s)+i.buildRegExpStr()});return typeof a(this,ee)=="number"&&r.unshift(`#${a(this,ee)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},ee=new WeakMap,te=new WeakMap,F=new WeakMap,bt),Xt=(vt=class{constructor(){p(this,He,{varIndex:0});p(this,Pe,new We)}insert(e,t,r){const s=[],i=[];for(let c=0;;){let h=!1;if(e=e.replace(/\{[^}]+\}/g,o=>{const l=`@\\${c}`;return i[c]=[l,o],c++,h=!0,l}),!h)break}const n=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let c=i.length-1;c>=0;c--){const[h]=i[c];for(let o=n.length-1;o>=0;o--)if(n[o].indexOf(h)!==-1){n[o]=n[o].replace(h,i[c][1]);break}}return a(this,Pe).insert(n,t,s,a(this,He),r),s}buildRegExp(){let e=a(this,Pe).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(i,n,c)=>n!==void 0?(r[++t]=Number(n),"$()"):(c!==void 0&&(s[Number(c)]=++t),"")),[new RegExp(`^${e}`),r,s]}},He=new WeakMap,Pe=new WeakMap,vt),ct=[],Qt=[/^$/,[],Object.create(null)],Ne=Object.create(null);function ht(e){return Ne[e]??(Ne[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function Yt(){Ne=Object.create(null)}function Zt(e){var l;const t=new Xt,r=[];if(e.length===0)return Qt;const s=e.map(u=>[!/\*|\/:/.test(u[0]),...u]).sort(([u,w],[b,P])=>u?1:b?-1:w.length-P.length),i=Object.create(null);for(let u=0,w=-1,b=s.length;u<b;u++){const[P,S,x]=s[u];P?i[S]=[x.map(([A])=>[A,Object.create(null)]),ct]:w++;let N;try{N=t.insert(S,w,P)}catch(A){throw A===ve?new it(S):A}P||(r[w]=x.map(([A,we])=>{const Ce=Object.create(null);for(we-=1;we>=0;we--){const[T,ze]=N[we];Ce[T]=ze}return[A,Ce]}))}const[n,c,h]=t.buildRegExp();for(let u=0,w=r.length;u<w;u++)for(let b=0,P=r[u].length;b<P;b++){const S=(l=r[u][b])==null?void 0:l[1];if(!S)continue;const x=Object.keys(S);for(let N=0,A=x.length;N<A;N++)S[x[N]]=h[S[x[N]]]}const o=[];for(const u in c)o[u]=r[c[u]];return[n,o,i]}function ce(e,t){if(e){for(const r of Object.keys(e).sort((s,i)=>i.length-s.length))if(ht(r).test(t))return[...e[r]]}}var er=(mt=class{constructor(){p(this,de);d(this,"name","RegExpRouter");p(this,G);p(this,J);f(this,G,{[O]:Object.create(null)}),f(this,J,{[O]:Object.create(null)})}add(e,t,r){var h;const s=a(this,G),i=a(this,J);if(!s||!i)throw new Error(nt);s[e]||[s,i].forEach(o=>{o[e]=Object.create(null),Object.keys(o[O]).forEach(l=>{o[e][l]=[...o[O][l]]})}),t==="/*"&&(t="*");const n=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const o=ht(t);e===O?Object.keys(s).forEach(l=>{var u;(u=s[l])[t]||(u[t]=ce(s[l],t)||ce(s[O],t)||[])}):(h=s[e])[t]||(h[t]=ce(s[e],t)||ce(s[O],t)||[]),Object.keys(s).forEach(l=>{(e===O||e===l)&&Object.keys(s[l]).forEach(u=>{o.test(u)&&s[l][u].push([r,n])})}),Object.keys(i).forEach(l=>{(e===O||e===l)&&Object.keys(i[l]).forEach(u=>o.test(u)&&i[l][u].push([r,n]))});return}const c=Ye(t)||[t];for(let o=0,l=c.length;o<l;o++){const u=c[o];Object.keys(i).forEach(w=>{var b;(e===O||e===w)&&((b=i[w])[u]||(b[u]=[...ce(s[w],u)||ce(s[O],u)||[]]),i[w][u].push([r,n-l+o+1]))})}}match(e,t){Yt();const r=g(this,de,Nt).call(this);return this.match=(s,i)=>{const n=r[s]||r[O],c=n[2][i];if(c)return c;const h=i.match(n[0]);if(!h)return[[],ct];const o=h.indexOf("",1);return[n[1][o],h]},this.match(e,t)}},G=new WeakMap,J=new WeakMap,de=new WeakSet,Nt=function(){const e=Object.create(null);return Object.keys(a(this,J)).concat(Object.keys(a(this,G))).forEach(t=>{e[t]||(e[t]=g(this,de,kt).call(this,t))}),f(this,G,f(this,J,void 0)),e},kt=function(e){const t=[];let r=e===O;return[a(this,G),a(this,J)].forEach(s=>{const i=s[e]?Object.keys(s[e]).map(n=>[n,s[e][n]]):[];i.length!==0?(r||(r=!0),t.push(...i)):e!==O&&t.push(...Object.keys(s[O]).map(n=>[n,s[O][n]]))}),r?Zt(t):null},mt),tr=(Et=class{constructor(e){d(this,"name","SmartRouter");p(this,X,[]);p(this,z,[]);f(this,X,e.routers)}add(e,t,r){if(!a(this,z))throw new Error(nt);a(this,z).push([e,t,r])}match(e,t){if(!a(this,z))throw new Error("Fatal error");const r=a(this,X),s=a(this,z),i=r.length;let n=0,c;for(;n<i;n++){const h=r[n];try{for(let o=0,l=s.length;o<l;o++)h.add(...s[o]);c=h.match(e,t)}catch(o){if(o instanceof it)continue;throw o}this.match=h.match.bind(h),f(this,X,[h]),f(this,z,void 0);break}if(n===i)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,c}get activeRouter(){if(a(this,z)||a(this,X).length!==1)throw new Error("No active router has been determined yet.");return a(this,X)[0]}},X=new WeakMap,z=new WeakMap,Et),me=Object.create(null),lt=(Rt=class{constructor(e,t,r){p(this,U);p(this,Q);p(this,I);p(this,re);p(this,pe,0);p(this,C,me);if(f(this,I,r||Object.create(null)),f(this,Q,[]),e&&t){const s=Object.create(null);s[e]={handler:t,possibleKeys:[],score:0},f(this,Q,[s])}f(this,re,[])}insert(e,t,r){f(this,pe,++Pt(this,pe)._);let s=this;const i=Ht(t),n=[];for(let o=0,l=i.length;o<l;o++){const u=i[o],w=i[o+1],b=Je(u,w),P=Array.isArray(b)?b[0]:u;if(Object.keys(a(s,I)).includes(P)){s=a(s,I)[P];const S=Je(u,w);S&&n.push(S[1]);continue}a(s,I)[P]=new lt,b&&(a(s,re).push(b),n.push(b[1])),s=a(s,I)[P]}const c=Object.create(null),h={handler:r,possibleKeys:n.filter((o,l,u)=>u.indexOf(o)===l),score:a(this,pe)};return c[e]=h,a(s,Q).push(c),s}search(e,t){var h;const r=[];f(this,C,me);let i=[this];const n=Ge(t),c=[];for(let o=0,l=n.length;o<l;o++){const u=n[o],w=o===l-1,b=[];for(let P=0,S=i.length;P<S;P++){const x=i[P],N=a(x,I)[u];N&&(f(N,C,a(x,C)),w?(a(N,I)["*"]&&r.push(...g(this,U,ie).call(this,a(N,I)["*"],e,a(x,C))),r.push(...g(this,U,ie).call(this,N,e,a(x,C)))):b.push(N));for(let A=0,we=a(x,re).length;A<we;A++){const Ce=a(x,re)[A],T=a(x,C)===me?{}:{...a(x,C)};if(Ce==="*"){const Y=a(x,I)["*"];Y&&(r.push(...g(this,U,ie).call(this,Y,e,a(x,C))),f(Y,C,T),b.push(Y));continue}if(u==="")continue;const[ze,Ot,De]=Ce,K=a(x,I)[ze],hr=n.slice(o).join("/");if(De instanceof RegExp){const Y=De.exec(hr);if(Y){if(T[Ot]=Y[0],r.push(...g(this,U,ie).call(this,K,e,a(x,C),T)),Object.keys(a(K,I)).length){f(K,C,T);const Ue=((h=Y[0].match(/\//))==null?void 0:h.length)??0;(c[Ue]||(c[Ue]=[])).push(K)}continue}}(De===!0||De.test(u))&&(T[Ot]=u,w?(r.push(...g(this,U,ie).call(this,K,e,T,a(x,C))),a(K,I)["*"]&&r.push(...g(this,U,ie).call(this,a(K,I)["*"],e,T,a(x,C)))):(f(K,C,T),b.push(K)))}}i=b.concat(c.shift()??[])}return r.length>1&&r.sort((o,l)=>o.score-l.score),[r.map(({handler:o,params:l})=>[o,l])]}},Q=new WeakMap,I=new WeakMap,re=new WeakMap,pe=new WeakMap,C=new WeakMap,U=new WeakSet,ie=function(e,t,r,s){const i=[];for(let n=0,c=a(e,Q).length;n<c;n++){const h=a(e,Q)[n],o=h[t]||h[O],l={};if(o!==void 0&&(o.params=Object.create(null),i.push(o),r!==me||s&&s!==me))for(let u=0,w=o.possibleKeys.length;u<w;u++){const b=o.possibleKeys[u],P=l[o.score];o.params[b]=s!=null&&s[b]&&!P?s[b]:r[b]??(s==null?void 0:s[b]),l[o.score]=!0}}return i},Rt),rr=(xt=class{constructor(){d(this,"name","TrieRouter");p(this,se);f(this,se,new lt)}add(e,t,r){const s=Ye(t);if(s){for(let i=0,n=s.length;i<n;i++)a(this,se).insert(e,s[i],r);return}a(this,se).insert(e,t,r)}match(e,t){return a(this,se).search(e,t)}},se=new WeakMap,xt),sr=class extends ot{constructor(e={}){super(e),this.router=e.router??new tr({routers:[new er,new rr]})}},nr=(e,t={fetch:globalThis.fetch.bind(globalThis)})=>r=>{r.respondWith((async()=>{const s=await e.fetch(r.request);return t.fetch&&s.status===404?await t.fetch(r.request):s})())};class he{constructor(t){d(this,"state","pending");d(this,"value");d(this,"reason");d(this,"onFulfilledCallbacks",[]);d(this,"onRejectedCallbacks",[]);const r=i=>{this.state==="pending"&&(this.state="fulfilled",this.value=i,this.onFulfilledCallbacks.forEach(n=>n()))},s=i=>{this.state==="pending"&&(this.state="rejected",this.reason=i,this.onRejectedCallbacks.forEach(n=>n()))};try{t(r,s)}catch(i){s(i)}}then(t,r){return new he((s,i)=>{if(this.state==="fulfilled")try{const n=t?t(this.value):this.value;s(n)}catch(n){i(n)}else if(this.state==="rejected")try{const n=r?r(this.reason):this.reason;s(n)}catch(n){i(n)}else this.state==="pending"&&(this.onFulfilledCallbacks.push(()=>{try{const n=t?t(this.value):this.value;s(n)}catch(n){i(n)}}),this.onRejectedCallbacks.push(()=>{try{const n=r?r(this.reason):this.reason;s(n)}catch(n){i(n)}}))})}}async function ir(e){const t=e.headers.get("Content-Type");let r;switch(t){case"application/json":r="json";break;case"application/octet-stream":r="arrayBuffer";break;case"text/number":r="number";break;case"text/boolean":r="boolean";break;default:r="text";break}switch(r){case"number":return Number(await e.text());case"json":return e.json();case"arrayBuffer":return e.arrayBuffer();case"blob":return e.blob();case"text":return e.text();case"boolean":return await e.text()==="1";default:return e.body}}const ge=class ge{constructor({cachePrefix:t="app",cacheNamespace:r="default",broadId:s="global"}={}){d(this,"cachePrefix");d(this,"cacheNamespace");d(this,"broadId");d(this,"cacheName");d(this,"cache");d(this,"isInitialized",!1);if(ge.instance)return ge.instance;this.cachePrefix=t,this.cacheNamespace=r,this.broadId=s,this.cacheName=`${this.cachePrefix}-${this.cacheNamespace}-${this.broadId}`,ge.instance=this}init(){return new he(async(t,r)=>{try{this.cache=await caches.open(this.cacheName),this.isInitialized=!0,t(this.cache)}catch(s){this.handleError(s),r(s)}})}setItem(t,r,s="text/plain"){return new he(async(i,n)=>{var c;if(!this.isInitialized){const h=new Error("CacheManager is not initialized. Call init() before using setItem.");this.handleError(h),n(h);return}try{const h=new Response(JSON.stringify(r),{headers:{"Content-Type":s}});await((c=this.cache)==null?void 0:c.put(t,h)),i(!0)}catch(h){this.handleError(h),n(h)}})}getItem(t){return new he(async(r,s)=>{var i;if(!this.isInitialized){const n=new Error("CacheManager is not initialized. Call init() before using getItem.");this.handleError(n),s(n);return}try{const n=await((i=this.cache)==null?void 0:i.match(t));if(!n){r(null);return}const c=await ir(n);r(c)}catch(n){this.handleError(n),s(n)}})}removeItem(t){return new he(async(r,s)=>{var i;if(!this.isInitialized){const n=new Error("CacheManager is not initialized. Call init() before using removeItem.");this.handleError(n),s(n);return}try{await((i=this.cache)==null?void 0:i.delete(t)),r(!0)}catch(n){this.handleError(n),s(n)}})}handleError(t){throw new Error(t.stack||t)}};d(ge,"instance");let Be=ge;const ke=new Be({cachePrefix:"FloatBlog",cacheNamespace:"ConfigData",broadId:"service-worker"}),Se={instance:null},ut=async()=>{if(Se.instance)return Se.instance;try{return await ke.init(),Se.instance=ke,ke}catch(e){console.error("Init cache failed:",e)}},ar=async e=>{if(Se.instance)try{return await ke.getItem(e)!==null}catch{return!1}else throw new Error("CacheManager is not initialized. Call init() before using hasItem.")},qe=new sr;let Ae;ut().then(e=>{Ae=e});const or=e=>{if(e.endsWith(".html")){const t=e.split("/").pop(),r=t.slice(0,t.lastIndexOf("."));return e.replace(t,`${r}-html.json`)}return e},ft=async e=>{var s;e.endsWith("/")&&(e+="index.html"),e=or(e);const t=((s=await(Ae==null?void 0:Ae.getItem("version")))==null?void 0:s.split('"')[1])||"",r=`${y.registryBaseUrl}${y.packageName}/${t}/files${e}`;return fetch(r)};qe.get("*",async e=>{let t=e.req.path;const r=await ft(t);return r.url.includes(".svg")&&e.header("Content-Type","image/svg+xml"),r.status===404?e.notFound():e.body(await r.arrayBuffer())}),qe.notFound(async e=>e.body(await(await ft("/404.html")).arrayBuffer(),404));const cr=nr(qe),dt={isChecked:!1},pt=async()=>{var t;const e=await ut();if(!dt.isChecked){const r=await(await fetch(`${y.registryBaseUrl}${y.packageName}/latest`,{cache:"no-store"})).json();dt.isChecked=!0,await ar("version")?Number((t=await e.getItem("version"))==null?void 0:t.split("-")[1].replace('"',""))<Number(r.version.split("-")[1])&&await e.setItem("version",r.version):await e.setItem("version",r.version)}};addEventListener("install",()=>{pt()}),self.addEventListener("fetch",e=>{if((e.request.url.includes(y.blogDomain)||y.localMode)&&(!e.request.url.includes(y.serviceWorkerName)||e.request.url.includes("service-worker"))&&e.request.url.startsWith(self.location.origin))return pt(),cr(e);e.respondWith(fetch(e.request))})})();
