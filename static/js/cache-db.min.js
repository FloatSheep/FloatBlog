(()=>{function e(e,n,r){this.config=r||{auto:0},this.config.auto=this.config.auto||0,this.namespace=e||"CacheDBDefaultNameSpace",this.prefix=n||"CacheDBDefaultPrefix",this.read=async function(e,t){return t=t||{},t.type=t.type||(this.config.auto?"auto":"text"),new Promise((n,r)=>{caches.open(this.namespace).then(o=>{o.match(new Request(`https://${this.prefix}/${encodeURIComponent(e)}`)).then(async e=>{if(e){if("auto"===t.type){const n=e.headers.get("Content-Type");switch(n){case"application/json":t.type="json";break;case"application/octet-stream":t.type="arrayBuffer";break;case"application/octet-stream":t.type="blob";break;case"text/number":t.type="number";break;case"text/boolean":t.type="boolean";break;default:t.type="text"}}switch(t.type){case"number":return void n(Number(await e.text()));case"json":return void n(e.json());case"arrayBuffer":return void n(e.arrayBuffer());case"blob":return void n(e.blob());case"text":return void n(e.text());case"boolean":return void n(1==await e.text());default:return void n(e.body)}}else r(new Error("Response is undefined."))}).catch(e=>{console.error("CacheDB Read Error:",e),r(e)})}).catch(e=>{console.error("CacheDB Open Error:",e),r(e)})})},this.write=async function(e,n,r){switch(r=r||{},r.type=r.type||(this.config.auto?"auto":"text"),"auto"===r.type&&(r.type=t(n)?"json":typeof n),r.type){case"json":r.content_type="application/json",n=JSON.stringify(n);break;case"arrayBuffer":case"blob":r.content_type="application/octet-stream";break;case"number":r.content_type="text/number",n=n.toString();break;case"boolean":r.content_type="text/boolean",n=n?1:0}return new Promise((t,o)=>{caches.open(this.namespace).then(o=>{o.put(new Request(`https://${this.prefix}/${encodeURIComponent(e)}`),new Response(n,{headers:{"Content-Type":r.content_type}})).then(t(1))}).catch(e=>{console.error("CacheDB Write Erorr:"+e),o(0)})})},this.delete=async function(e){return new Promise((t,n)=>{caches.open(this.namespace).then(n=>{n.delete(new Request(`https://${this.prefix}/${encodeURIComponent(e)}`)).then(t(!0))}).catch(e=>{console.error("CacheDB Delete Erorr:"+e),n(!1)})})},this.list=async function(){return new Promise((e,t)=>{caches.open(this.namespace).then(t=>{t.keys().then(t=>{e(t.map(e=>decodeURIComponent(e.url.split("/").pop())))})}).catch(e=>{console.error("CacheDB List Erorr:"+e),t([])})})},this.all=async function(){const e={};return new Promise(async(t,n)=>{this.list().then(async n=>{await Promise.all(n.map(async t=>{e[t]=await this.read(t)})),t(e)}).catch(e=>{console.error("CacheDB All Erorr:"+e),n([])})})},this.clear=async function(){return new Promise((e,t)=>{this.list().then(t=>{t.forEach(e=>{this.delete(e)}),e(!0)}).catch(e=>{console.error("CacheDB Clear Erorr:"+e),t(!1)})})},this.destroy=async function(){return new Promise((e,t)=>{this.clear().then(()=>{caches.delete(this.namespace).then(e(!0))}).catch(e=>{console.error("CacheDB Destroy Erorr:"+e),t(!1)})})}}const t=function(e){return"object"==typeof e&&null!==e&&e.constructor===Object||Array.isArray(e)};self.CacheDB=e})();