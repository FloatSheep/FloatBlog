(()=>{"use strict";self.CacheDB=function(e,t,n){this.config=n||{auto:0},this.config.auto=this.config.auto||0,this.namespace=e||"CacheDBDefaultNameSpace",this.prefix=t||"CacheDBDefaultPrefix",this.read=async function(e,t){return(t=t||{}).type=t.type||this.config.auto?"auto":"text",new Promise(((n,a)=>{caches.open(this.namespace).then((a=>{a.match(new Request(`https://${this.prefix}/${encodeURIComponent(e)}`)).then((async e=>{if("auto"===t.type)switch(e.headers.get("Content-Type")){case"application/json":t.type="json";break;case"application/octet-stream":t.type="arrayBuffer";break;case"application/octet-stream":t.type="blob";break;case"text/number":t.type="number";break;case"text/boolean":t.type="boolean";break;default:t.type="text"}switch(t.type){case"number":return void n(Number(await e.text()));case"json":return void n(e.json());case"arrayBuffer":return void n(e.arrayBuffer());case"blob":return void n(e.blob());case"text":return void n(e.text());case"boolean":return void n(1==await e.text());default:return void n(e.body)}}))})).catch((e=>{console.error("CacheDB Read Erorr:"+e),a(null)}))}))},this.write=async function(e,t,n){var a;switch((n=n||{}).type=n.type||this.config.auto?"auto":"text","auto"===n.type&&(n.type="object"==typeof(a=t)&&null!==a&&a.constructor===Object||Array.isArray(a)?"json":typeof t),n.type){case"json":n.content_type="application/json",t=JSON.stringify(t);break;case"arrayBuffer":case"blob":n.content_type="application/octet-stream";break;case"number":n.content_type="text/number",t=t.toString();break;case"boolean":n.content_type="text/boolean",t=t?1:0}return new Promise(((a,r)=>{caches.open(this.namespace).then((r=>{r.put(new Request(`https://${this.prefix}/${encodeURIComponent(e)}`),new Response(t,{headers:{"Content-Type":n.content_type}})).then(a(1))})).catch((e=>{console.error("CacheDB Write Erorr:"+e),r(0)}))}))},this.delete=async function(e){return new Promise(((t,n)=>{caches.open(this.namespace).then((n=>{n.delete(new Request(`https://${this.prefix}/${encodeURIComponent(e)}`)).then(t(!0))})).catch((e=>{console.error("CacheDB Delete Erorr:"+e),n(!1)}))}))},this.list=async function(){return new Promise(((e,t)=>{caches.open(this.namespace).then((t=>{t.keys().then((t=>{e(t.map((e=>decodeURIComponent(e.url.split("/").pop()))))}))})).catch((e=>{console.error("CacheDB List Erorr:"+e),t([])}))}))},this.all=async function(){const e={};return new Promise((async(t,n)=>{this.list().then((async n=>{await Promise.all(n.map((async t=>{e[t]=await this.read(t)}))),t(e)})).catch((e=>{console.error("CacheDB All Erorr:"+e),n([])}))}))},this.clear=async function(){return new Promise(((e,t)=>{this.list().then((t=>{t.forEach((e=>{this.delete(e)})),e(!0)})).catch((e=>{console.error("CacheDB Clear Erorr:"+e),t(!1)}))}))},this.destroy=async function(){return new Promise(((e,t)=>{this.clear().then((()=>{caches.delete(this.namespace).then(e(!0))})).catch((e=>{console.error("CacheDB Destroy Erorr:"+e),t(!1)}))}))}}})();